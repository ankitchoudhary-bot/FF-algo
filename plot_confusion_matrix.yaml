name: Plot Confusion Matrix for FFNetwork
description: Generates and displays the confusion matrix based on model predictions and true labels.

inputs:
  - {name: y_test, type: Dataset}
  - {name: preds, type: Dataset}

implementation:
  container:
    image: python:3.8
    command:
      - sh
      - -c
      - |
        python3 -m pip install --quiet matplotlib scikit-learn numpy
        exec "$0" "$@"
      - python3
      - -u
      - -c
      - |
        import argparse
        import numpy as np
        import matplotlib.pyplot as plt
        from sklearn.metrics import confusion_matrix, ConfusionMatrixDisplay

        parser = argparse.ArgumentParser()
        parser.add_argument('--y_test', required=True)
        parser.add_argument('--preds', required=True)
        args = parser.parse_args()

        y_test = np.load(args.y_test)
        preds = np.load(args.preds)

        cm = confusion_matrix(y_test, preds)
        disp = ConfusionMatrixDisplay(confusion_matrix=cm)
        disp.plot()
        plt.title("Confusion Matrix")
        plt.grid(False)
        plt.savefig("/tmp/confusion_matrix.png")
        print("Confusion matrix saved at /tmp/confusion_matrix.png")
    args:
      - --y_test
      - {inputPath: y_test}
      - --preds
      - {inputPath: preds}
